<?php require 'views/header.html'; ?>

<h1>Todo List</h1>

<div
  style="display: grid;grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));gap: 1rem;margin-bottom: 2rem;">
  <div style="background: #e3f2fd;padding: 1rem;border-radius: 8px;text-align: center;">
    <h3 style="margin: 0; color: #1100f8"><?= $stats['total'] ?></h3>
    <small>My Total Tasks</small>
  </div>
  <div style="background: #e8f5e8;padding: 1rem;border-radius: 8px;text-align: center;">
    <h3 style="margin: 0; color: #388e3c"><?= $stats['completed'] ?></h3>
    <small>Completed tasks</small>
  </div>
  <div style="background: #fff3e0;padding: 1rem;border-radius: 8px;text-align: center;">
    <h3 style="margin: 0; color: #f57c00"><?= $stats['pending'] ?></h3>
    <small>Pending tasks</small>
  </div>
  <div
    style="
      background: #f8ebe9;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
    "
  >
    <h3 style="margin: 0; color: #c2185b"><?= count($todayTodos) ?></h3>
    <small>Due Today</small>
  </div>
</div>

<section style="margin-bottom: 2rem">
  <h2 style="color: #000000; display: flex; align-items: center; gap: 0.5rem">
    Due Today
    <span
      style="
        background: #ffebee;
        color: #d32f2f;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.8rem;
      "
    >
      <?= count($todayTodos) ?>
    </span>
  </h2>

  <?php if (empty($todayTodos)): ?>
  <article style="background: #f8ebe9; border-left: 4px solid #c34a4a">
    <p>No tasks due today! You're all caught up.</p>
  </article>
  <?php else: ?>
  <?php foreach ($todayTodos as $todo): ?>
  <?php $badgeColor = $todo['status'] == 1 ? '#4caf50' : '#f44336';$status = $todo['status'] == 1 ? 'Complete' : 'Due Today!';?>
  <article $style="border-left: 4px solid <?php echo $badgeColor; ?>; margin-bottom: 1rem;">

    <header>
      <small
        >Due:
        <?= htmlspecialchars(date('F jS, Y', strtotime($todo['due_date']))) ?></small
      >
    </header>
    <div style="display: flex; justify-content: space-between; align-items: center">
      <h3 $style="<?= $todo['status'] == 1 ? 'text-decoration: line-through; opacity: 0.6;' : '' ?>"
      >
        <?= htmlspecialchars($todo['title']) ?>
      </h3>
      <span
        class="badge"$style="background-color: <?= $badgeColor ?>;color: white;padding: 0.25rem 0.5rem;border-radius: 0.25rem;">
        <?= htmlspecialchars($status) ?>
      </span>
    </div>
    <footer>
      <div style="display: flex; gap: 0.5rem">
        <?php if ($todo['status'] == 0): ?>
        <a
          href="complete.php?id=<?= $todo['id'] ?>"
          role="button"
          class="secondary"
          >Mark as Complete</a
        >
        <?php endif; ?>
        <a href="edit.php?id=<?= $todo['id'] ?>" role="button" class="contrast"
          >Edit</a
        >
        <a
          href="delete.php?id=<?= $todo['id'] ?>"
          role="button"
          class="contrast"
          onclick="return confirm('Are you sure you want to delete this todo?')"
          >Delete</a
        >
      </div>
    </footer>
  </article>
  <?php endforeach; ?>
  <?php endif; ?>
</section>

<section>
  <h2>All Tasks</h2>

  <?php if (empty($todos)): ?>
  <article>
    <p>No todos found. <a href="create.php">Create your todo now!</a></p>
  </article>
  <?php else: ?>
  <?php foreach ($todos as $todo): ?>
  <?php
                $badgeColor = $todo['status'] == 1 ? '#4caf50' : '#f44336';
                $status = $todo['status'] == 1 ? 'Complete' : 'Pending';
            ?>
  <article>
    <header>
      <small
        >Due:
        <?= htmlspecialchars(date('F jS, Y', strtotime($todo['due_date']))) ?></small
      >
    </header>
    <div
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <h3 style6="<?= $todo['status'] == 1 ? 'text-decoration: line-through; opacity: 0.6;' : '' ?>">
        <?= htmlspecialchars($todo['title']) ?>
      </h3>
      <span
        class="badge"style="background-color: <?= $badgeColor ?>;color: white;padding: 0.25rem 0.5rem;border-radius: 0.25rem;">
        <?= htmlspecialchars($status) ?>
      </span>
    </div>
    <footer>
      <div style="display: flex; gap: 0.5rem">
        <?php if ($todo['status'] == 0): ?>
        <a
          href="complete.php?id=<?= $todo['id'] ?>"
          role="button"
          class="secondary"
          >Mark Complete</a
        >
        <?php endif; ?>
        <a href="edit.php?id=<?= $todo['id'] ?>" role="button" class="contrast"
          >Edit</a
        >
        <a
          href="delete.php?id=<?= $todo['id'] ?>"
          role="button"
          class="contrast"
          onclick="return confirm('Are you sure you want to delete this todo?')"
          >Delete</a
        >
      </div>
    </footer>
  </article>
  <?php endforeach; ?>
  <?php endif; ?>
</section>

<div style="margin-top: 2rem; text-align: center">
  <a href="create.php" role="button" class="primary">Add New Todo</a>
</div>

<?php require 'views/footer.html'; ?>
